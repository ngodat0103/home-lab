Vagrant.configure("2") do |config|
 config.vm.define "nfs-server" do |nfs_server|
 nfs_server.vm.box = "gusztavvargadr/ubuntu-server-2204-lts"
 nfs_server.vm.network "private_network", ip: "192.168.57.13"
 nfs_server.vm.hostname = "nfs-server"
 nfs_server.vm.box_version = "2506.0.0"
 nfs_server.vm.provision "shell", path: "nfs-server-setup.sh"
 end
 config.vm.define "master" do |master|
 master.vm.box = "gusztavvargadr/ubuntu-server-2204-lts"
 master.vm.network "private_network", ip: "192.168.57.10"
 master.vm.hostname = "master-node"
 master.vm.box_version = "2506.0.0"
 master.vm.provision "shell", path: "master.sh"
 master.vm.provider "virtualbox" do |vb| 
 vb.memory = 4096 
 # Create additional disk for /data
 disk_path = "./data/master-data-disk.vdi"
 unless File.exist?(disk_path)
   vb.customize ['createhd', '--filename', disk_path, '--size', 50 * 1024] # 50GB
 end
 vb.customize ['storageattach', :id, '--storagectl', 'SATA Controller', '--port', 1, '--device', 0, '--type', 'hdd', '--medium', disk_path]
end 
 # Provision script to format and mount the disk
 master.vm.provision "shell", inline: <<-SHELL
   # Format the disk if not already formatted
   if ! blkid /dev/sdb; then
     mkfs.ext4 /dev/sdb
   fi
   # Create mount point
   mkdir -p /data
   # Add to fstab if not already present
   if ! grep -q "/dev/sdb" /etc/fstab; then
     echo "/dev/sdb /data ext4 defaults 0 2" >> /etc/fstab
   fi
   # Mount the disk
   mount -a
 SHELL
 end


 config.vm.define "worker1" do |worker1|
 worker1.vm.box = "gusztavvargadr/ubuntu-server-2204-lts"
 worker1.vm.network "private_network", ip: "192.168.57.11"
 worker1.vm.hostname = "worker1"
 worker1.vm.box_version = "2506.0.0"
 worker1.vm.provision "shell", path: "worker.sh"
 worker1.vm.provider "virtualbox" do |vb|
 vb.memory = 8096
 vb.cpus = 4
 # Create additional disk for /data
 disk_path = "./data/worker1-data-disk.vdi"
 unless File.exist?(disk_path)
   vb.customize ['createhd', '--filename', disk_path, '--size', 50 * 1024] # 50GB
 end
 vb.customize ['storageattach', :id, '--storagectl', 'SATA Controller', '--port', 1, '--device', 0, '--type', 'hdd', '--medium', disk_path]
end
 # Provision script to format and mount the disk
 worker1.vm.provision "shell", inline: <<-SHELL
   # Format the disk if not already formatted
   if ! blkid /dev/sdb; then
     mkfs.ext4 /dev/sdb
   fi
   # Create mount point
   mkdir -p /data
   # Add to fstab if not already present
   if ! grep -q "/dev/sdb" /etc/fstab; then
     echo "/dev/sdb /data ext4 defaults 0 2" >> /etc/fstab
   fi
   # Mount the disk
   mount -a
 SHELL
 end


 config.vm.define "worker2" do |worker2|
 worker2.vm.box = "gusztavvargadr/ubuntu-server-2204-lts"
 worker2.vm.network "private_network", ip: "192.168.57.12"
 worker2.vm.hostname = "worker2"
 worker2.vm.box_version = "2506.0.0"
 worker2.vm.provision "shell", path: "worker.sh"
 worker2.vm.provider "virtualbox" do |vb|
 vb.memory = 2048
 # Create additional disk for /data
 disk_path = "./data/worker2-data-disk.vdi"
 unless File.exist?(disk_path)
   vb.customize ['createhd', '--filename', disk_path, '--size', 50 * 1024] # 50GB
 end
 vb.customize ['storageattach', :id, '--storagectl', 'SATA Controller', '--port', 1, '--device', 0, '--type', 'hdd', '--medium', disk_path]
 end
 # Provision script to format and mount the disk
 worker2.vm.provision "shell", inline: <<-SHELL
   # Format the disk if not already formatted
   if ! blkid /dev/sdb; then
     mkfs.ext4 /dev/sdb
   fi
   # Create mount point
   mkdir -p /data
   # Add to fstab if not already present
   if ! grep -q "/dev/sdb" /etc/fstab; then
     echo "/dev/sdb /data ext4 defaults 0 2" >> /etc/fstab
   fi
   # Mount the disk
   mount -a
 SHELL
 end
end